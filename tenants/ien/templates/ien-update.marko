import contentList from "../graphql/fragments/content-list";

$ const { newsletter, date } = data;

<common-document newsletter=newsletter date=date>
  <h1>Hello ${newsletter.name}</h1>
  <h3>My current date is ${date.format("MMM Do, YYYY")}</h3>

  <marko-web-query|{ nodes }| name="newsletter-scheduled-content" params={
    date: date.valueOf(),
    newsletterId: newsletter.id,
    sectionName: "Featured Story",
    limit: 1,
    queryFragment: contentList,
  }>
    <for|node| of=nodes>
      <marko-core-obj-value|{ value: image }| obj=node field="primaryImage" as="object">
        <marko-newsletter-imgix
          src=image.src
          alt=image.alt
          options={ w: 630 }
          class="main"
          attrs={ border: 0, width: 630 }
        >
          <@link href=node.websiteUrl target="_blank" />
        </marko-newsletter-imgix>
      </marko-core-obj-value>

      <marko-core-obj-text tag="h4" obj=node field="name">
        <@link href=node.websiteUrl target="_blank" class="my-cool-class" attrs={
          style: "color: red;",
          "data-foo": "bar",
          "aria-hidden": "false",
        } />
      </marko-core-obj-text>
      <marko-core-obj-text tag="p" obj=node field="teaser" html=true />
      <marko-core-obj-date tag="small" obj=node field="published" format="MMMM Do, YYYY" />
      <hr>
    </for>
  </marko-web-query>

  <hr>

  <marko-web-query|{ nodes }| name="newsletter-scheduled-content" params={
    date: date.valueOf(),
    newsletterId: newsletter.id,
    sectionName: "Co-Features",
    excludeContentTypes: ["TextAd"],
    queryFragment: contentList,
  }>
    <for|node| of=nodes>
      <marko-core-obj-value|{ value: image }| obj=node field="primaryImage" as="object">
        <marko-newsletter-imgix
          src=image.src
          alt=image.alt
          options={ w: 300 }
          class="main"
          attrs={ border: 0, width: 300 }
        >
          <@link href=node.websiteUrl target="_blank" />
        </marko-newsletter-imgix>
      </marko-core-obj-value>
      <marko-core-obj-text tag="h4" obj=node field="name">
        <@link href=node.websiteUrl target="_blank" />
      </marko-core-obj-text>
      <marko-core-obj-text tag="p" obj=node field="teaser" html=true />
      <hr>
    </for>
  </marko-web-query>

  <hr>

  <marko-web-query|{ nodes }| name="newsletter-scheduled-content" params={
    date: date.valueOf(),
    newsletterId: newsletter.id,
    sectionName: "Text Ad Sponsors",
    includeContentTypes: ["TextAd"],
    queryFragment: contentList,
  }>
    <for|node| of=nodes>
      <marko-core-obj-value|{ value: image }| obj=node field="primaryImage" as="object">
        <marko-newsletter-imgix
          src=image.src
          alt=image.alt
          options={ w: 150 }
          class="main"
          attrs={ border: 0, width: 150 }
        >
          <@link href=node.websiteUrl target="_blank" />
        </marko-newsletter-imgix>
      </marko-core-obj-value>
      <marko-core-obj-text tag="h4" obj=node field="name">
        <@link href=node.websiteUrl target="_blank" />
      </marko-core-obj-text>
      <if(node.type === "text-ad")>
        <marko-core-obj-text obj=node field="body" html=true />
      </if>
      <else>
        <marko-core-obj-text tag="p" obj=node field="teaser" html=true />
      </else>

      <if(node.type === "text-ad")>
        <marko-core-obj-text tag="p" obj=node field="linkText">
          <@link href=node.websiteUrl target="_blank" />
        </marko-core-obj-text>
      </if>
      <hr>
    </for>
  </marko-web-query>

  <hr>
  <marko-web-query|{ nodes }| name="newsletter-scheduled-content" params={
    date: date.valueOf(),
    newsletterId: newsletter.id,
    sectionName: "Main",
    queryFragment: contentList,
  }>
    <for|node| of=nodes>
      <marko-core-obj-value|{ value: image }| obj=node field="primaryImage" as="object">
        <marko-newsletter-imgix
          src=image.src
          alt=image.alt
          options={ w: 150 }
          class="main"
          attrs={ border: 0, width: 150 }
        >
          <@link href=node.websiteUrl target="_blank" />
        </marko-newsletter-imgix>
      </marko-core-obj-value>

      <marko-core-obj-text tag="h4" obj=node field="name">
        <@link href=node.websiteUrl target="_blank" />
      </marko-core-obj-text>
      <if(node.type === "text-ad")>
        <marko-core-obj-text obj=node field="body" html=true />
      </if>
      <else>
        <marko-core-obj-text tag="p" obj=node field="teaser" html=true />
      </else>
      <if(node.type === "text-ad")>
        <marko-core-obj-text tag="p" obj=node field="linkText">
          <@link href=node.websiteUrl target="_blank" />
        </marko-core-obj-text>
      </if>
      <else>
        <marko-core-obj-nodes|{ node: author }| obj=node field="authors">
          <marko-core-obj-text obj=author field="name">
            <@link href=author.websiteUrl target="_blank" />
          </marko-core-obj-text>
        </marko-core-obj-nodes>
      </else>
      <hr>
    </for>
  </marko-web-query>
</common-document>
